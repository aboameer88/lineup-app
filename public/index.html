<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Abo Ameer Lineups âš½ | ØªØ´ÙƒÙŠÙ„ØªÙƒ Ø¨Ø§Ø­ØªØ±Ø§Ù</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Ø£Ù†Ø´Ø¦ ØªØ´ÙƒÙŠÙ„ØªÙƒ Ø§Ù„ÙƒØ±ÙˆÙŠØ© Ø¨Ø§Ø­ØªØ±Ø§ÙØŒ Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ ÙØ±ÙŠÙ‚ÙƒØŒ ÙˆØ§Ø­Ø¬Ø² Ù…Ø±ÙƒØ²Ùƒ ÙÙŠ Ø§Ù„Ù…Ù„Ø¹Ø¨.">
  <meta name="theme-color" content="#0d47a1" />
  <link rel="icon" type="image/png" href="logo.png" />

  <style>
    :root {
      --bg-gradient: radial-gradient(circle at top, #1d4ed8 0, transparent 55%), radial-gradient(circle at bottom, #22c55e 0, transparent 55%), #020617;
      --card-bg: rgba(15, 23, 42, 0.96);
      --border-soft: rgba(148, 163, 184, 0.35);
      --text-main: #e5e7eb;
      --accent-primary: #1d4ed8;
      --accent-secondary: #22c55e;
      --pitch-line: rgba(226, 232, 240, 0.5);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Cairo", sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top, rgba(37, 99, 235, 0.35), transparent 55%),
        radial-gradient(circle at bottom, rgba(34, 197, 94, 0.35), transparent 55%),
        #020617;
      background-attachment: fixed;
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
      gap: 16px;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 18px;
      border-radius: 18px;
      background: linear-gradient(120deg, rgba(15,23,42,0.95), rgba(15,23,42,0.8));
      border: 1px solid rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(18px);
      box-shadow: 0 20px 45px rgba(15,23,42,0.9);
      gap: 8px;
      flex-wrap: wrap;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-badge {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #16a34a, #14532d);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 18px;
      color: #e5e7eb;
      box-shadow: 0 10px 25px rgba(22, 163, 74, 0.8);
    }

    .logo-text-main {
      font-size: 18px;
      font-weight: 700;
    }

    .logo-text-sub {
      font-size: 11px;
      color: #9ca3af;
    }

    .top-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .primary-btn,
    .secondary-btn {
      padding: 7px 15px;
      border-radius: 999px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      white-space: nowrap;
      border: none;
      transition: 0.18s ease-out;
    }

    .primary-btn {
      background: linear-gradient(135deg, #1d4ed8, #22c55e);
      color: #f9fafb;
      box-shadow: 0 12px 28px rgba(34,197,94,0.65);
    }

    .secondary-btn {
      background: rgba(15,23,42,0.96);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .primary-btn:hover {
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 18px 40px rgba(34,197,94,0.9);
    }

    .secondary-btn:hover {
      border-color: #22c55e;
      transform: translateY(-1px);
    }

    .layout {
      display: grid;
      grid-template-columns: 250px minmax(0, 1fr) 250px;
      gap: 12px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background:
        radial-gradient(circle at top left, rgba(59,130,246,0.18), transparent 45%),
        radial-gradient(circle at bottom right, rgba(34,197,94,0.20), transparent 55%),
        rgba(15, 23, 42, 0.96);
      border-radius: 20px;
      padding: 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow: 0 14px 32px rgba(15,23,42,0.85);
    }

    .panel-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-title span {
      font-size: 11px;
      color: #9ca3af;
      font-weight: 400;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 4px;
    }

    .field-label {
      font-size: 11px;
      color: #9ca3af;
    }

    .field-input,
    .field-select {
      width: 100%;
      padding: 6px 9px;
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      font-size: 12px;
      outline: none;
    }

    .field-input:focus,
    .field-select:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.35);
    }

    .color-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .color-row input[type="color"] {
      width: 30px;
      height: 30px;
      padding: 0;
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: transparent;
      cursor: pointer;
    }

    .kit-preview {
      width: 26px;
      height: 26px;
      border-radius: 8px;
      border: 1px solid rgba(15,23,42,0.8);
      background: rgba(15,23,42,0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
    }

    .pitch-card {
      background:
        radial-gradient(circle at top, rgba(59,130,246,0.22), transparent 55%),
        radial-gradient(circle at bottom, rgba(34,197,94,0.25), transparent 55%),
        rgba(15,23,42,0.98);
      border-radius: 24px;
      padding: 14px;
      border: 1px solid rgba(148,163,184,0.45);
      box-shadow: 0 26px 55px rgba(15,23,42,0.98);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .pitch-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      color: #9ca3af;
      flex-wrap: wrap;
      gap: 8px;
    }

    .teams-label {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pill {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 10px;
    }

    .pitch-header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .players-count-control {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
    }

    .players-count-control select {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.96);
      color: #e5e7eb;
      font-size: 11px;
      outline: none;
    }

    .reserve-counter {
      font-size: 11px;
      color: #e5e7eb;
    }

    .reserve-counter-full {
      color: #22c55e;
      font-weight: 700;
    }

    .pitch-wrapper {
      position: relative;
      width: 100%;
      padding-top: 62%;
      border-radius: 20px;
      overflow: hidden;
      background-image: repeating-linear-gradient(
        90deg,
        #166534,
        #166534 10%,
        #15803d 10%,
        #15803d 20%
      );
      box-shadow: inset 0 0 0 1px #065f46;
    }

    .pitch {
      position: absolute;
      inset: 8px;
      border-radius: 16px;
      border: 2px solid var(--pitch-line);
    }

    .pitch-line {
      position: absolute;
      border: 2px solid var(--pitch-line);
      border-radius: 999px;
    }

    .center-line {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      width: 0;
      border-left: 2px solid var(--pitch-line);
    }

    .center-circle {
      width: 80px;
      height: 80px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .penalty-box {
      width: 18%;
      height: 40%;
      top: 30%;
    }

    .penalty-box.left {
      left: 0;
      border-left: none;
      border-radius: 0 16px 16px 0;
    }

    .penalty-box.right {
      right: 0;
      border-right: none;
      border-radius: 16px 0 0 16px;
    }

    .six-yard {
      width: 8%;
      height: 20%;
      top: 40%;
    }

    .six-yard.left {
      left: 0;
      border-left: none;
      border-radius: 0 12px 12px 0;
    }

    .six-yard.right {
      right: 0;
      border-right: none;
      border-radius: 12px 0 0 12px;
    }

    .pen-spot {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--pitch-line);
    }

    .pen-spot.left {
      left: 11%;
      top: 50%;
      transform: translateY(-50%);
    }

    .pen-spot.right {
      right: 11%;
      top: 50%;
      transform: translateY(-50%);
    }

    .center-spot {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--pitch-line);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .player {
      position: absolute;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      cursor: pointer;
      touch-action: none;
    }

    .player::after {
      content: "";
      position: absolute;
      bottom: -6px;
      left: 50%;
      transform: translateX(-50%);
      width: 36px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at center, rgba(0,0,0,0.45), transparent);
      filter: blur(2px);
      z-index: 0;
    }

    .shirt {
      width: 64px;
      height: 64px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border-radius: 0;
      box-shadow: none;
      overflow: visible;
    }

    .shirt-img {
      position: relative;
      width: 100%;
      height: 100%;
      object-fit: contain;
      opacity: 1;
      pointer-events: none;
    }

    .shirt-tint,
    .shirt-highlight {
      display: none !important;
    }

    .shirt-number {
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      font-weight: 800;
      font-size: 11px;
      color: #f9fafb;
      text-shadow: 0 1px 3px rgba(0,0,0,0.9);
      z-index: 2;
    }

    .player-name {
      font-size: 9px;
      max-width: 70px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #e5e7eb;
      text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }

    .player.dragging .shirt {
      transform: translateY(-3px) scale(1.07);
      transition: transform 0.08s ease;
    }

    /* Ø­Ø§Ø±Ø³ Ø§Ù„Ù…Ø±Ù…Ù‰ */
    .player--gk .shirt {
      transform: scale(1.03);
    }

    /* ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© */
    .player--taken .player-name {
      color: #22c55e;
      font-weight: 700;
    }

    .player--taken .player-name::before {
      content: "Ù…Ø­Ø¬ÙˆØ²";
      display: block;
      font-size: 8px;
      color: #22c55e;
      margin-bottom: 1px;
    }

    .bench {
      margin-top: 8px;
      padding: 8px;
      border-radius: 12px;
      border: 1px dashed rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.97);
    }

    .bench-global {
      max-width: 720px;
      margin: 0 auto;
    }

    .bench-title {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 6px;
      text-align: center;
    }

    .bench-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }

    .bench-item {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.96);
      cursor: pointer;
      transition: 0.15s ease;
    }

    .bench-item:hover {
      border-color: #22c55e;
      transform: translateY(-1px);
    }

    .footer-tip {
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="top-bar">
      <div class="logo">
        <div class="logo-badge">AA</div>
        <div>
          <div class="logo-text-main">Abo Ameer Lineups</div>
          <div class="logo-text-sub">Ù…Ù†ØµÙ‘Ø© Ø¹ØµØ±ÙŠØ© Ù„ØµÙ†Ø§Ø¹Ø© ØªØ´ÙƒÙŠÙ„Ø§Øª ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…</div>
        </div>
      </div>
      <div class="top-actions">
        <button class="secondary-btn" id="export-image-btn">ğŸ“· ØªØµØ¯ÙŠØ± ÙƒØµÙˆØ±Ø©</button>
        <button class="secondary-btn" id="share-lineup-btn">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© (48 Ø³Ø§Ø¹Ø©)</button>
        <button class="primary-btn" id="new-setup-btn">ï¼‹ ØªØ´ÙƒÙŠÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
      </div>
    </header>

    <main class="layout">
      <section class="panel">
        <div class="panel-title">
          Ø§Ù„ÙØ±ÙŠÙ‚ A
          <span>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ¶ÙŠÙ</span>
        </div>

        <div class="field-group">
          <label class="field-label">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚</label>
          <input id="teamA-name" class="field-input" type="text" value="ÙØ±ÙŠÙ‚ A" />
        </div>

        <div class="field-group">
          <label class="field-label">Ø§Ù„Ø®Ø·Ø©</label>
          <select id="teamA-formation" class="field-select">
            <option value="4-3-3">4-3-3 Ù‡Ø¬ÙˆÙ…ÙŠØ©</option>
            <option value="4-2-3-1">4-2-3-1 Ù…ØªÙˆØ§Ø²Ù†Ø©</option>
            <option value="4-4-2">4-4-2 ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©</option>
            <option value="3-5-2">3-5-2 Ø§Ø³ØªØ­ÙˆØ§Ø°</option>
            <option value="3-4-1">3-4-1 (9 Ù„Ø§Ø¹Ø¨ÙŠÙ†)</option>
          </select>
        </div>

        <div class="field-group">
          <label class="field-label">Ù„ÙˆÙ† Ø§Ù„ÙØ±ÙŠÙ‚ (Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·)</label>
          <div class="color-row">
            <input id="teamA-color" type="color" value="#2563eb" />
            <div class="kit-preview" id="teamA-kit-preview">A</div>
          </div>
        </div>
      </section>

      <section class="pitch-card" id="pitch-card">
        <div class="pitch-header">
          <div class="teams-label">
            <span class="pill" id="label-teamA">ÙØ±ÙŠÙ‚ A</span>
            <span>vs</span>
            <span class="pill" id="label-teamB">ÙØ±ÙŠÙ‚ B</span>
          </div>
          <div class="pitch-header-right">
            <div class="players-count-control">
              <label for="players-count">Ø§Ù„Ø£Ø³Ø§Ø³ÙŠÙŠÙ†:</label>
              <select id="players-count">
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9 (Ø®Ø·Ø© 3-4-1)</option>
                <option value="10">10</option>
                <option value="11" selected>11</option>
              </select>
            </div>
            <div id="reserve-counter" class="reserve-counter">
              Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©: 0 / 22
            </div>
            <div id="mode-indicator">ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ â€“ Ø§Ø¶Ø¨Ø· ØªØ´ÙƒÙŠÙ„ØªÙƒØŒ Ø­Ø±Ù‘Ùƒ Ø§Ù„Ù…Ø±Ø§ÙƒØ²ØŒ Ø«Ù… Ø´Ø§Ø±Ùƒ Ø£Ùˆ ØµØ¯Ù‘Ø±</div>
          </div>
        </div>

        <div class="pitch-wrapper">
          <div class="pitch" id="pitch">
            <div class="center-line"></div>
            <div class="pitch-line center-circle"></div>

            <div class="pitch-line penalty-box left"></div>
            <div class="pitch-line penalty-box right"></div>
            <div class="pitch-line six-yard left"></div>
            <div class="pitch-line six-yard right"></div>

            <div class="pen-spot left"></div>
            <div class="pen-spot right"></div>
            <div class="center-spot"></div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-title">
          Ø§Ù„ÙØ±ÙŠÙ‚ B
          <span>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¶ÙŠÙ</span>
        </div>

        <div class="field-group">
          <label class="field-label">Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚</label>
          <input id="teamB-name" class="field-input" type="text" value="ÙØ±ÙŠÙ‚ B" />
        </div>

        <div class="field-group">
          <label class="field-label">Ø§Ù„Ø®Ø·Ø©</label>
          <select id="teamB-formation" class="field-select">
            <option value="4-3-3">4-3-3 Ù‡Ø¬ÙˆÙ…ÙŠØ©</option>
            <option value="4-2-3-1">4-2-3-1 Ù…ØªÙˆØ§Ø²Ù†Ø©</option>
            <option value="4-4-2">4-4-2 ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©</option>
            <option value="3-5-2">3-5-2 Ø§Ø³ØªØ­ÙˆØ§Ø°</option>
            <option value="3-4-1">3-4-1 (9 Ù„Ø§Ø¹Ø¨ÙŠÙ†)</option>
          </select>
        </div>

        <div class="field-group">
          <label class="field-label">Ù„ÙˆÙ† Ø§Ù„ÙØ±ÙŠÙ‚ (Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·)</label>
          <div class="color-row">
            <input id="teamB-color" type="color" value="#dc2626" />
            <div class="kit-preview" id="teamB-kit-preview">B</div>
          </div>
        </div>
      </section>
    </main>

    <div class="bench bench-global">
      <div class="bench-title">Ø§Ù„Ø¥Ø­ØªÙŠØ§Ø· (Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…)</div>
      <div class="bench-list" id="benchGlobal">
        <div class="bench-item">12</div>
        <div class="bench-item">13</div>
        <div class="bench-item">14</div>
        <div class="bench-item">15</div>
        <div class="bench-item">16</div>
        <div class="bench-item">17</div>
        <div class="bench-item">18</div>
        <div class="bench-item">19</div>
        <div class="bench-item">20</div>
      </div>
    </div>

    <div class="footer-tip">
      Ø§Ø³Ø­Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ²ØŒ Ù‚Ù… Ø¨ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠÙŠÙ†ØŒ Ø«Ù… Ø´Ø§Ø±Ùƒ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø£Ùˆ Ø§Ø­ÙØ¸Ù‡Ø§ ÙƒØµÙˆØ±Ø©. ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ÙŠÙ…ÙƒÙ†Ù‡ Ø­Ø¬Ø² Ù…Ø±ÙƒØ² ÙˆØ§Ø­Ø¯ØŒ ÙˆÙŠÙ…ÙƒÙ†Ù‡ Ø¥Ø²Ø§Ù„Ø© Ø§Ø³Ù…Ù‡ Ù…Ù† Ù…Ø±ÙƒØ²Ù‡ ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± Ø¹Ù† Ø§Ù„Ù„Ø¹Ø¨.
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    'use strict';

    const formations = {
      "4-3-3": [
        { x: 8,  y: 50 },
        { x: 22, y: 18 }, { x: 22, y: 36 }, { x: 22, y: 64 }, { x: 22, y: 82 },
        { x: 36, y: 26 }, { x: 36, y: 50 }, { x: 36, y: 74 },
        { x: 50, y: 26 }, { x: 50, y: 50 }, { x: 50, y: 74 }
      ],
      "4-2-3-1": [
        { x: 8,  y: 50 },
        { x: 22, y: 18 }, { x: 22, y: 36 }, { x: 22, y: 64 }, { x: 22, y: 82 },
        { x: 34, y: 38 }, { x: 34, y: 62 },
        { x: 48, y: 26 }, { x: 48, y: 50 }, { x: 48, y: 74 },
        { x: 60, y: 50 }
      ],
      "4-4-2": [
        { x: 8,  y: 50 },
        { x: 22, y: 18 }, { x: 22, y: 36 }, { x: 22, y: 64 }, { x: 22, y: 82 },
        { x: 36, y: 18 }, { x: 36, y: 36 }, { x: 36, y: 64 }, { x: 36, y: 82 },
        { x: 50, y: 40 }, { x: 50, y: 60 }
      ],
      "3-5-2": [
        { x: 8,  y: 50 },
        { x: 22, y: 24 }, { x: 22, y: 50 }, { x: 22, y: 76 },
        { x: 34, y: 16 }, { x: 34, y: 84 },
        { x: 38, y: 34 }, { x: 38, y: 50 }, { x: 38, y: 66 },
        { x: 52, y: 40 }, { x: 52, y: 60 }
      ],
      // 3-4-1 Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø§Ù„Ø®Ø·ÙˆØ· Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„ØªØ¯Ø§Ø®Ù„
      "3-4-1": [
        { x: 6,  y: 50 }, // GK

        { x: 18, y: 25 },
        { x: 18, y: 50 },
        { x: 18, y: 75 },

        { x: 30, y: 20 },
        { x: 30, y: 40 },
        { x: 30, y: 60 },
        { x: 30, y: 80 },

        { x: 42, y: 50 }
      ]
    };

    const pitchEl = document.getElementById('pitch');
    const pitchCardEl = document.getElementById('pitch-card');
    const labelTeamA = document.getElementById('label-teamA');
    const labelTeamB = document.getElementById('label-teamB');
    const modeIndicator = document.getElementById('mode-indicator');
    const reserveCounterEl = document.getElementById('reserve-counter');

    const teamANameInput = document.getElementById('teamA-name');
    const teamBNameInput = document.getElementById('teamB-name');

    const teamAFormationSelect = document.getElementById('teamA-formation');
    const teamBFormationSelect = document.getElementById('teamB-formation');

    const teamAColorInput = document.getElementById('teamA-color');
    const teamBColorInput = document.getElementById('teamB-color');

    const teamAKitPreview = document.getElementById('teamA-kit-preview');
    const teamBKitPreview = document.getElementById('teamB-kit-preview');

    const newSetupBtn = document.getElementById('new-setup-btn');
    const shareBtn = document.getElementById('share-lineup-btn');
    const exportBtn = document.getElementById('export-image-btn');

    const benchGlobal = document.getElementById('benchGlobal');
    const playersCountSelect = document.getElementById('players-count');

    let mode = 'owner';
    let shareId = null;
    let playersCount = 11;

    let playersData = {
      A: Array(11).fill(null).map((_, i) => ({ number: i + 1, name: '', claimedBy: null })),
      B: Array(11).fill(null).map((_, i) => ({ number: i + 1, name: '', claimedBy: null }))
    };

    let positions = { A: [], B: [] };

    function getParticipantId() {
      let pid = localStorage.getItem('participant_id');
      if (!pid) {
        pid = 'p_' + Date.now().toString(36) + Math.random().toString(36).substring(2, 8);
        localStorage.setItem('participant_id', pid);
      }
      return pid;
    }

    function getCurrentLineupPayload() {
      return {
        teamAName: teamANameInput.value || 'ÙØ±ÙŠÙ‚ A',
        teamBName: teamBNameInput.value || 'ÙØ±ÙŠÙ‚ B',
        teamAColor: teamAColorInput.value,
        teamBColor: teamBColorInput.value,
        players: playersData,
        playersCount: playersCount,
        positions: positions
      };
    }

    function updateTeamLabels() {
      labelTeamA.innerText = teamANameInput.value || 'ÙØ±ÙŠÙ‚ A';
      labelTeamB.innerText = teamBNameInput.value || 'ÙØ±ÙŠÙ‚ B';
    }

    function updateKitPreviews() {
      teamAKitPreview.style.background = teamAColorInput.value;
      teamBKitPreview.style.background = teamBColorInput.value;
    }

    function enableBenchEditing(benchEl) {
      const items = benchEl.querySelectorAll('.bench-item');
      items.forEach((item) => {
        item.addEventListener('click', () => {
          const current = item.innerText;
          const newName = prompt('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·:', current);
          if (newName !== null) {
            const trimmed = newName.trim();
            item.innerText = trimmed || current;
          }
        });
      });
    }

    function ensurePositionsForTeam(team) {
      const form = team === 'A' ? teamAFormationSelect.value : teamBFormationSelect.value;
      const base = formations[form] || formations['4-3-3'];

      if (!positions[team] || positions[team].length === 0) {
        positions[team] = base.slice(0, playersCount).map((p) => {
          if (team === 'A') {
            return { x: p.x, y: p.y };
          }
          return { x: 100 - p.x, y: p.y };
        });
      } else {
        if (positions[team].length < playersCount) {
          const extra = base.slice(positions[team].length, playersCount).map((p) => {
            if (team === 'A') {
              return { x: p.x, y: p.y };
            }
            return { x: 100 - p.x, y: p.y };
          });
          positions[team] = positions[team].concat(extra);
        } else if (positions[team].length > playersCount) {
          positions[team] = positions[team].slice(0, playersCount);
        }
      }
    }

    function resetPositionsFromFormation() {
      positions.A = [];
      positions.B = [];
      ensurePositionsForTeam('A');
      ensurePositionsForTeam('B');
    }

    function updateReserveCounter() {
      if (!reserveCounterEl) return;

      const count = playersCount || 11;
      const totalSlots = count * 2;
      let filled = 0;

      ['A', 'B'].forEach(team => {
        const arr = playersData[team] || [];
        for (let i = 0; i < count; i++) {
          if (arr[i] && arr[i].name && arr[i].name.trim() !== '') {
            filled++;
          }
        }
      });

      reserveCounterEl.innerText = `Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©: ${filled} / ${totalSlots}`;

      if (filled === totalSlots) {
        reserveCounterEl.classList.add('reserve-counter-full');
      } else {
        reserveCounterEl.classList.remove('reserve-counter-full');
      }
    }

    function isLineupFull() {
      const count = playersCount || 11;

      function teamFull(team) {
        const arr = playersData[team] || [];
        let filled = 0;
        for (let i = 0; i < count; i++) {
          if (arr[i] && arr[i].name && arr[i].name.trim() !== '') {
            filled++;
          }
        }
        return filled === count;
      }

      return teamFull('A') && teamFull('B');
    }

    function renderTeams() {
      const existingPlayers = pitchEl.querySelectorAll('.player');
      existingPlayers.forEach((p) => p.remove());

      ensurePositionsForTeam('A');
      ensurePositionsForTeam('B');

      const colorA = teamAColorInput.value;
      const colorB = teamBColorInput.value;

      positions.A.slice(0, playersCount).forEach((pos, idx) => {
        createPlayer('A', idx, pos.x, pos.y, colorA);
      });

      positions.B.slice(0, playersCount).forEach((pos, idx) => {
        createPlayer('B', idx, pos.x, pos.y, colorB);
      });

      updateReserveCounter();
    }

    function enableDrag(playerEl) {
      let isDragging = false;
      let dragMoved = false;

      function getClientXY(e) {
        if (e.touches && e.touches.length > 0) {
          return { x: e.touches[0].clientX, y: e.touches[0].clientY };
        }
        return { x: e.clientX, y: e.clientY };
      }

      function onDown(e) {
        if (mode !== 'owner') return;
        e.preventDefault();
        isDragging = true;
        dragMoved = false;
        playerEl.classList.add('dragging');

        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onUp);
        document.addEventListener('touchmove', onMove, { passive: false });
        document.addEventListener('touchend', onUp);
      }

      function onMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        const rect = pitchEl.getBoundingClientRect();
        const client = getClientXY(e);

        let x = ((client.x - rect.left) / rect.width) * 100;
        let y = ((client.y - rect.top) / rect.height) * 100;

        x = Math.max(4, Math.min(96, x));
        y = Math.max(8, Math.min(92, y));

        const oldLeft = parseFloat(playerEl.style.left || '0');
        const oldTop = parseFloat(playerEl.style.top || '0');
        const dx = Math.abs(x - oldLeft);
        const dy = Math.abs(y - oldTop);
        if (dx > 0.3 || dy > 0.3) {
          dragMoved = true;
        }

        playerEl.style.left = x + '%';
        playerEl.style.top = y + '%';
      }

      function onUp() {
        if (!isDragging) return;
        isDragging = false;
        playerEl.classList.remove('dragging');

        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('touchend', onUp);

        const team = playerEl.dataset.team;
        const index = parseInt(playerEl.dataset.index, 10);
        const x = parseFloat(playerEl.style.left);
        const y = parseFloat(playerEl.style.top);
        if (!positions[team]) positions[team] = [];
        positions[team][index] = { x, y };

        playerEl.dataset.dragMoved = dragMoved ? '1' : '0';
      }

      playerEl.addEventListener('mousedown', onDown);
      playerEl.addEventListener('touchstart', onDown, { passive: false });
    }

    function createPlayer(team, index, x, y, color) {
      const playerEl = document.createElement('div');
      playerEl.className = 'player';
      playerEl.style.left = x + '%';
      playerEl.style.top = y + '%';
      playerEl.dataset.team = team;
      playerEl.dataset.index = index.toString();
      playerEl.dataset.dragMoved = '0';

      const playerInfo = playersData[team][index];

      if (playerInfo.name && playerInfo.name.trim() !== '') {
        playerEl.classList.add('player--taken');
      }

      if (index === 0) {
        playerEl.classList.add('player--gk');
      }

      const shirtEl = document.createElement('div');
      shirtEl.className = 'shirt';

      const imgEl = document.createElement('img');
      imgEl.className = 'shirt-img';

      if (index === 0) {
        imgEl.src = team === 'A' ? 'gk_teamA.png' : 'gk_teamB.png';
      } else {
        imgEl.src = team === 'A' ? 'shirt_teamA.png' : 'shirt_teamB.png';
      }
      imgEl.alt = '';

      const tintEl = document.createElement('div');
      tintEl.className = 'shirt-tint';

      const hlEl = document.createElement('div');
      hlEl.className = 'shirt-highlight';

      const numberEl = document.createElement('div');
      numberEl.className = 'shirt-number';
      numberEl.innerText = playerInfo.number;

      const nameEl = document.createElement('div');
      nameEl.className = 'player-name';
      nameEl.innerText = playerInfo.name || 'Ù„Ø§Ø¹Ø¨';

      shirtEl.appendChild(imgEl);
      shirtEl.appendChild(tintEl);
      shirtEl.appendChild(hlEl);
      shirtEl.appendChild(numberEl);

      playerEl.appendChild(shirtEl);
      playerEl.appendChild(nameEl);

      playerEl.addEventListener('click', async () => {
        if (playerEl.dataset.dragMoved === '1') {
          playerEl.dataset.dragMoved = '0';
          return;
        }

        const currentName = playersData[team][index].name || '';

        if (mode === 'owner') {
          const promptLabel = 'Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (' + playerInfo.number + ') ÙÙŠ ' + (team === 'A' ? 'Ø§Ù„ÙØ±ÙŠÙ‚ A' : 'Ø§Ù„ÙØ±ÙŠÙ‚ B');
          const newName = prompt(promptLabel, currentName);
          if (newName !== null) {
            const trimmed = newName.trim();
            playersData[team][index].name = trimmed;
            nameEl.innerText = trimmed || 'Ù„Ø§Ø¹Ø¨';

            if (trimmed) {
              playerEl.classList.add('player--taken');
            } else {
              playerEl.classList.remove('player--taken');
            }

            updateReserveCounter();
          }
          return;
        }

        if (mode === 'guest') {
          const participantId = getParticipantId();

          if (currentName.trim() !== '') {
            if (playersData[team][index].claimedBy === participantId) {
              const confirmRemove = confirm('Ø£Ù†Øª Ø­Ø§Ù„ÙŠØ§Ù‹ Ø­Ø§Ø¬Ø² Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ² Ø¨Ø§Ø³Ù…Ùƒ.\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© Ø§Ø³Ù…Ùƒ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ²ØŸ');
              if (confirmRemove) {
                try {
                  const res = await fetch('/api/lineups/' + shareId + '/unclaim', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                      participantId: participantId,
                      team: team,
                      index: index
                    })
                  });
                  const data = await res.json();
                  if (!res.ok) {
                    alert(data.message || 'ØªØ¹Ø°Ø± Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ².');
                    return;
                  }
                  playersData = data.players;
                  nameEl.innerText = 'Ù„Ø§Ø¹Ø¨';
                  playerEl.classList.remove('player--taken');
                  updateReserveCounter();
                  alert('ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ø³Ù…Ùƒ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ² ÙˆÙŠÙ…ÙƒÙ† Ù„Ø´Ø®Øµ Ø¢Ø®Ø± Ø­Ø¬Ø²Ù‡ Ø§Ù„Ø¢Ù†.');
                } catch (err) {
                  console.error(err);
                  alert('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.');
                }
              }
            } else {
              alert('Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ² Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„.');
            }
            return;
          }

          if (!shareId) {
            alert('Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­ Ù„Ù„Ø­Ø¬Ø².');
            return;
          }

          const playerName = prompt('Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù„Ø­Ø¬Ø² Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ²:');
          if (!playerName || !playerName.trim()) {
            return;
          }

          try {
            const res = await fetch('/api/lineups/' + shareId + '/claim', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                participantId: participantId,
                team: team,
                index: index,
                name: playerName.trim()
              })
            });

            const data = await res.json();

            if (!res.ok) {
              if (data.error === 'already_used') {
                alert('Ù„Ø¯ÙŠÙƒ Ù…Ø±ÙƒØ² Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø²Ø§Ù„Ø© Ø§Ø³Ù…Ùƒ Ù…Ù† Ù…Ø±ÙƒØ²Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹.');
              } else if (data.error === 'slot_taken') {
                alert('Ø³Ø¨Ù‚ Ø£Ù† Ø´Ø®Øµ Ø¢Ø®Ø± Ø­Ø¬Ø² Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ².');
              } else if (data.error === 'link_expired' || res.status === 410) {
                alert('Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ø§Ø¨Ø· (48 Ø³Ø§Ø¹Ø©).');
              } else if (data.error === 'out_of_range') {
                alert('Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ² Ø®Ø§Ø±Ø¬ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©.');
              } else {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø¬Ø² Ø§Ù„Ù…Ø±ÙƒØ².');
              }
              return;
            }

            playersData = data.players;
            nameEl.innerText = playerName.trim();
            playerEl.classList.add('player--taken');
            updateReserveCounter();

            alert('ØªÙ… Ø­Ø¬Ø² Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ² Ø¨Ø§Ø³Ù…Ùƒ. ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¥Ø²Ø§Ù„Ø© Ø§Ø³Ù…Ùƒ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…Ø±ÙƒØ² Ø¥Ø°Ø§ Ø§Ø¹ØªØ°Ø±Øª Ø¹Ù† Ø§Ù„Ù„Ø¹Ø¨.');

            if (isLineupFull()) {
              alert('Ø§ÙƒØªÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§ÙƒØ² ÙÙŠ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.');
            }
          } catch (err) {
            console.error(err);
            alert('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.');
          }
        }
      });

      if (mode === 'owner') {
        enableDrag(playerEl);
      }

      pitchEl.appendChild(playerEl);
    }

    async function createShareLink() {
      const payload = getCurrentLineupPayload();

      try {
        const res = await fetch('/api/lineups', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (!res.ok) {
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·');
          console.error(data);
          return;
        }

        shareId = data.id;
        const url = window.location.origin + '?share=' + shareId;

        let copied = false;

        if (navigator.clipboard && navigator.clipboard.writeText) {
          try {
            await navigator.clipboard.writeText(url);
            copied = true;
          } catch (e) {
            console.warn('clipboard api failed', e);
          }
        }

        if (!copied) {
          const dummy = document.createElement('input');
          dummy.value = url;
          document.body.appendChild(dummy);
          dummy.select();
          try {
            document.execCommand('copy');
            copied = true;
          } catch (e) {
            console.warn('execCommand copy failed', e);
          }
          document.body.removeChild(dummy);
        }

        if (copied) {
          alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© 48 Ø³Ø§Ø¹Ø©) ÙˆØªÙ… Ù†Ø³Ø®Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù„ØµÙ‚Ù‡ ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù†.\n\n' + url);
        } else {
          window.prompt('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© 48 Ø³Ø§Ø¹Ø©). Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§:', url);
        }
      } catch (err) {
        console.error(err);
        alert('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
      }
    }

    async function enterGuestMode(id) {
      try {
        const res = await fetch('/api/lineups/' + id);
        const data = await res.json();
        if (!res.ok) {
          alert(data.message || 'Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
          return;
        }

        const d = data.data;
        teamANameInput.value = d.teamAName;
        teamBNameInput.value = d.teamBName;
        teamAColorInput.value = d.teamAColor;
        teamBColorInput.value = d.teamBColor;
        playersData = d.players;

        playersCount = d.playersCount || 11;
        if (playersCount < 7) playersCount = 7;
        if (playersCount > 11) playersCount = 11;
        playersCountSelect.value = String(playersCount);

        if (d.positions) {
          positions = d.positions;
        } else {
          resetPositionsFromFormation();
        }

        teamANameInput.disabled = true;
        teamBNameInput.disabled = true;
        teamAFormationSelect.disabled = true;
        teamBFormationSelect.disabled = true;
        teamAColorInput.disabled = true;
        teamBColorInput.disabled = true;
        playersCountSelect.disabled = true;

        newSetupBtn.style.display = 'none';
        shareBtn.style.display = 'none';
        exportBtn.style.display = 'none';

        mode = 'guest';
        modeIndicator.innerText = 'ÙˆØ¶Ø¹ Ø§Ù„Ø¶ÙŠÙ â€“ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø¬Ø² Ù…Ø±ÙƒØ² ÙˆØ§Ø­Ø¯ Ø¨Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø¥Ø²Ø§Ù„Ø© Ø§Ø³Ù…Ùƒ Ù…Ù† Ù…Ø±ÙƒØ²Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ.';

        updateTeamLabels();
        updateKitPreviews();
        renderTeams();

        alert('Ø§Ø®ØªØ± Ù…Ø±ÙƒØ²Ø§Ù‹ ÙØ§Ø¶ÙŠØ§Ù‹ Ù„Ø­Ø¬Ø²Ù‡ Ø¨Ø§Ø³Ù…ÙƒØŒ Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ²Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ø³Ù…Ùƒ.');
      } catch (err) {
        console.error(err);
        alert('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©');
      }
    }

    async function exportAsImage() {
      if (!window.html2canvas) {
        alert('Ù…ÙƒØªØ¨Ø© Ø§Ù„ØªØµØ¯ÙŠØ± ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©.');
        return;
      }
      try {
        const canvas = await html2canvas(pitchCardEl, {
          backgroundColor: null,
          scale: 2
        });
        const dataUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.href = dataUrl;
        link.download = 'lineup.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch (err) {
        console.error(err);
        alert('ØªØ¹Ø°Ø± ØªØµØ¯ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©.');
      }
    }

    newSetupBtn.addEventListener('click', () => {
      mode = 'owner';
      shareId = null;
      modeIndicator.innerText = 'ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ â€“ Ø§Ø¶Ø¨Ø· ØªØ´ÙƒÙŠÙ„ØªÙƒØŒ Ø­Ø±Ù‘Ùƒ Ø§Ù„Ù…Ø±Ø§ÙƒØ²ØŒ Ø«Ù… Ø´Ø§Ø±Ùƒ Ø£Ùˆ ØµØ¯Ù‘Ø±';

      teamANameInput.disabled = false;
      teamBNameInput.disabled = false;
      teamAFormationSelect.disabled = false;
      teamBFormationSelect.disabled = false;
      teamAColorInput.disabled = false;
      teamBColorInput.disabled = false;
      playersCountSelect.disabled = false;

      teamANameInput.value = 'ÙØ±ÙŠÙ‚ A';
      teamBNameInput.value = 'ÙØ±ÙŠÙ‚ B';
      teamAFormationSelect.value = '4-3-3';
      teamBFormationSelect.value = '4-3-3';
      teamAColorInput.value = '#2563eb';
      teamBColorInput.value = '#dc2626';

      playersData = {
        A: Array(11).fill(null).map((_, i) => ({ number: i + 1, name: '', claimedBy: null })),
        B: Array(11).fill(null).map((_, i) => ({ number: i + 1, name: '', claimedBy: null }))
      };

      playersCount = 11;
      playersCountSelect.value = '11';

      positions = { A: [], B: [] };

      updateTeamLabels();
      updateKitPreviews();
      resetPositionsFromFormation();
      renderTeams();
    });

    shareBtn.addEventListener('click', createShareLink);
    exportBtn.addEventListener('click', exportAsImage);

    [teamANameInput, teamBNameInput].forEach((input) => {
      input.addEventListener('input', updateTeamLabels);
    });

    [teamAFormationSelect, teamBFormationSelect].forEach((sel) => {
      sel.addEventListener('change', () => {
        resetPositionsFromFormation();
        renderTeams();
      });
    });

    [teamAColorInput, teamBColorInput].forEach((input) => {
      input.addEventListener('input', () => {
        updateKitPreviews();
        renderTeams();
      });
    });

    playersCountSelect.addEventListener('change', () => {
      const val = parseInt(playersCountSelect.value, 10);
      if (!isNaN(val)) {
        playersCount = val;
      } else {
        playersCount = 11;
      }
      if (playersCount < 7) playersCount = 7;
      if (playersCount > 11) playersCount = 11;
      resetPositionsFromFormation();
      renderTeams();
    });

    enableBenchEditing(benchGlobal);

    const params = new URLSearchParams(window.location.search);
    if (params.has('share')) {
      shareId = params.get('share');
      enterGuestMode(shareId);
    } else {
      updateTeamLabels();
      updateKitPreviews();
      resetPositionsFromFormation();
      renderTeams();
    }
  </script>
</body>
</html>
